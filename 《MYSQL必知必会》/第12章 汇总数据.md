# 第12章 汇总数据

>  本章介绍什么是SQL 的聚集函数以及如何利用它们汇总表的数据。

我们经常需要汇总数据而不用把它们实际检索出来，为此MySQL 提供了专门的函数。

使用这些函数，MySQL 查询可用于检索数据，以便分析和报表生成。 这种类型的检索例子有以下几种。

*  确定表中行数（或者满足某个条件或包含某个特定值的行数）。
*  获得表中行组的和。
*  找出表列（或所有行或某些特定的行）的最大值、最小值和平均值。

**注**

**聚集函数（aggregate function ）** 运行在行组上，计算和返回单个值的函数。

| 函  数 |      说  明      |
| :----: | :--------------: |
| AVG()  | 返回某列的平均值 |
| COUNT() | 返回某列的行数 |
| MAX() | 返回某列的最大值 |
| MIN() | 返回某列的最小值 |
| SUM() | 返回某列值之和 |

**12.1.1 AVG()示例**

```
SELECT AVG(prod_price) AS avg_price
FROM products;
```

**分析**

此SELECT 语句返回值avg_Price ，它包含products 表中所有

产品的平均价格。如第10 章所述，avg_price 是一个别名。

```
SELECT AVG(prod_price) AS avg_price
FROM products
WHERE vend_id = 1003;
```

**分析**

这条SELECT 语句与前一条的不同之处在于它包含了WHERE 子句。此WHERE 子句仅过滤出vend_id 为1003 的产品，因此avg_price 中返回的值只是该供应商的产品的平均值。

**12.1.2 COUNT()函数**

COUNT()函数进行计数。 可利用COUNT() 确定表中行的数目或符合特定条件的行的数目。

下面的例子返回customers 表中客户的总数：

```
SELECT COUNT(*) AS num_cust
FROM customers;
```

在此例子中，利用COUNT(*) 对所有行计数，不管行中各列有什么值。计数值在num_cust 中返回。

下面的例子只对具有电子邮件地址的客户计数：

```
SELECT COUNT(cust_email) AS num_cust
FROM customers;
```

**分析**

这条SELECT 语句使用COUNT(cust_email) 对cust_email 列中有值的行进行计数。在此例子中，cust_email 的计数为3 （表示5 个客户中只有3 个客户有电子邮件地址）。

**注**：

如果指定列名，则指定列的值为空的行被COUNT()函数忽略，但如果COUNT() 函数中用的是星号（* ），则不忽略。

**12.1.3 MAX()函数**

MAX()返回指定列中的最大值。MAX()要求指定列名，如下所示：

```
SELECT MAX(prod_price) AS max_price
FROM products;
```

**分析**

这里，MAX() 返回products 表中最贵的物品的价格。

**注**：

* 对非数值数据使用MAX()

  虽然MAX() 一般用来找出最大的数值或日期值，但MySQL 允许将它用来返回任意列中的最大值，包括返回文本列中的最大值。在用于文本数据时，如果数据按相应的列排序，则MAX() 返回最后一行。

* NULL值

  MAX()函数忽略列值为NULL的行。

**12.1.4 MIN()函数**

MIN()的功能正好与MAX()功能相反，它返回指定列的最小值。与MAX()一样，MIN()要求指定列名。

**12.1.5 SUM()函数**

SUM()用来返回指定列值的和（总计）。

```
SELECT SUM(quantity) AS items_ordered
FROM orderitems
WHERE order_num = 2005;
```

## 12.2 聚集不同的值

```
SELECT AVG(DISTINCT prod_price) AS avg_price
FROM products
WHERE vend_id = 1003;
```

**注**

如果指定列名，则DISTINCT 只能用于COUNT() 。DISTINCT不能用于COUNT(*)，因此不允许使用COUNT（DISTINCT），否则会产生错误 。类似地，DISTINCT 必须使用列名，不能用于计算或表达式。

## 12.3 组合聚集函数

目前为止的所有聚集函数例子都只涉及单个函数。但实际上SELECT 语句可根据需要包含多个聚集函数。请看下面的例子：

```
SELECT COUNT(*) AS num_items,
	   MIN(prod_price) AS price_min,
	   MAX(prod_price) AS price_max,
	   AVG(prod_price) AS price_avg
FROM products;
```

**分析**

这里用单条SELECT 语句执行了4 个聚集计算，返回4 个值（products 表中物品的数目，产品价格的最高、最低以及平均值）。


















