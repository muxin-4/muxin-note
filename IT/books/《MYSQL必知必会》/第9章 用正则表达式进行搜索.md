# 第9章 用正则表达式进行搜索

>  本章将学习如何在MySQL WHERE 子句内使用正则表达式来更好地控制数据过滤。

## 9.1 使用MySQL正则表达式

正则表达式的作用是匹配文本，将一个模式（正则表达式）与一个文本串进行比较。

MySQL用WHERE 子句对正则表达式提供了初步的支持，允许你指定正则表达式，过滤SELECT 检索出的数据。

### 9.1.1	基本字符匹配

我们从一个非常简单的例子开始。下面的语句检索列prod_name 包含文本1000 的所有行：

```
SELECT prod_name
FROM products
WHERE prod_name REGEXP '1000';
ORDER BY prod_name;
```

除关键字LIKE 被REGEXP 替代外，这条语句看上去非常像使用LIKE 的语句（第8 章）。它告诉MySQL ：REGEXP 后所跟的东西作为正则表达式（与文字正文1000 匹配的一个正则表达式）处理。

### 9.1.2 进行OR匹配

```
SELECT prod_name
FROM products
WHERE prod_name REGEXP '1000|2000'
ORDER BY prod_name;
```

**分析**

语句中使用了正则表达式1000|2000 。| 为正则表达式的OR 操作符。它表示匹配其中之一 ，因此1000 和2000 都匹配并返回。使用| 从功能上类似于在SELECT 语句中使用OR 语句，多个OR 条件可并入单个正则表达式。

### 9.1.3 匹配几个字符之一

```
SELECT prod_name
FROM products
WHERE prod_name REGEXP '[123] Ton'
ORDER BY prod_name;
```

**分析**

这里，使用了正则表达式[123] Ton 。[123] 定义一组字符，它的意思是匹配1 或2 或3 ，因此，1 ton 和2 ton 都匹配且返回（没有3 ton ）。

[^123]却匹配除这些字符外的任何东西

正则表达式[123]Ton为[1|2|3]Ton 的缩写，也可以使用后者



### 9.1.4 匹配范围

 集合可用来定义要匹配的一个或多个字符。

例如，下面的集合将匹配数字0到9：

[0123456789]和[0-9]相等

举个例子

```
SELECT prod_name
FROM products
WHERE prod_name REGEXP '[1-5] Ton'
ORDER BY prod_name;
```

**分析**

这里使用正则表达式[1-5] Ton 。[1-5] 定义了一个范围，这个表达式意思是匹配1到5 。

### 9.1.5 匹配特殊字符

例如查找.。

为了匹配特殊字符，必须用\\\ 为前导。\\\\- 表示查找- ，\\\\. 表示查找. 。

这种处理就是所谓的转义 （escaping ），正则表达式内具有特殊意义的所有字符都必须以这种方式转义。这包括. 、| 、[] 以及迄今为止使用过的其他特殊字符。

| 元字符 |  说  明  |
| :----: | :------: |
|  \\\f  |   换页   |
|  \\\n  |   换行   |
|  \\\r  |   回车   |
|  \\\t  |   制表   |
|  \\\v  | 纵向制表 |

### 9.1.6 匹配字符类

存在找出你自己经常使用的数字、所有字母字符或所有数字字母字符等的匹配。为更方便工作，可以使用预定义的字符集，称为字符类 （character class ）。

|  类  |  说  明  |
| :--: | :------: |
|  [:alnum:]  |  任意字母和数字(同[a-zA-Z0-9])    |
|  [:cntrl:]  |ASCII控制字符(ASCII 0到31和127)      |
|  [:punct:]  |  既不在[:alnum:]又不在[:cntrl:]中的任意字符    |
|  [:alpha:]  | 任意字符(同[a-zA-Z])     |
|  [:blank:]  |空格和制表(同[\\t])      |
|  [:digit:]  |  任意数字(同[0-9])    |
|  [:print:]  | 任意可打印字符     |
|  [:graph:]  | 与[:print:]相同，但不包括空格     |
|  [:lower:]  | 任意小写字母(同[a-z])     |
|  [:space:]  |  包括空格在内的任意空白字符（同[\\f\\n\\r\\t\\v]）    |
|  [:upper:]  |  任意大写字母（同[A-Z]）    |
|  [:xdigit:]  |  任意十六进制数字（同[a-fA-F0-9]）    |

### 9.1.7 匹配多个实例
|  元字符  |  说  明  |
| :--: | :------: |
| *  |   0个或多个匹配   |
| +  |  1个或多个匹配（等于{1,}）    |
| ?  |  0个或1个匹配（等于{0,1}）    |
|  {n} |  指定数目的匹配    |
| {n,}  |   不少于指定数目的匹配   |
| {n,m}  |  匹配数目的范围（m不超过255）    |

示例

```
SELECT prod_name
FROM products
WHERE prod_name REGEXP '[[:digit:]]{4}'
ORDER BY prod_name;
```

分析

 如前所述，[:digit:] 匹配任意数字，因而它为数字的一个集合。{4} 确切地要求它前面的字符（任意数字）出现4 次，所以[[:digit:]]{4} 匹配连在一起的任意4 位数字。

### 9.2.8 定位符
|  元字符  |  说  明  |
| :--: | :------: |
| ^ |   文本的开始   |
| $ |   文本的结尾   |
| [[:<:]] |   词的开始   |
| [[:>:]] |   词的结尾   |

示例

```
SELECT prod_name
FROM products
WHERE prod_name REGEXP '^[0-9\\.]'
ORDER BY prod_name;
```

**分析**

^匹配串的开始。因此，^[0-9\\.]只在.或任意数字为串中第一个字符时才匹配它们。














