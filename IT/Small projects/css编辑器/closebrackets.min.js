(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(f){var e={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"};var n=f.Pos;f.defineOption("autoCloseBrackets",false,function(i,r,q){if(q&&q!=f.Init){i.removeKeyMap(j);i.state.closeBrackets=null}if(r){i.state.closeBrackets=r;i.addKeyMap(j)}});function a(q,i){if(i=="pairs"&&typeof q=="string"){return q}if(typeof q=="object"&&q[i]!=null){return q[i]}return e[i]}var k=e.pairs+"`";var j={Backspace:d,Enter:b};for(var h=0;h<k.length;h++){j["'"+k.charAt(h)+"'"]=p(k.charAt(h))}function p(i){return function(q){return o(q,i)}}function m(i){var r=i.state.closeBrackets;if(!r){return null}var q=i.getModeAt(i.getCursor());return q.closeBrackets||r}function d(q){var s=m(q);if(!s||q.getOption("disableInput")){return f.Pass}var v=a(s,"pairs");var r=q.listSelections();for(var t=0;t<r.length;t++){if(!r[t].empty()){return f.Pass}var u=g(q,r[t].head);if(!u||v.indexOf(u)%2!=0){return f.Pass}}for(var t=r.length-1;t>=0;t--){var w=r[t].head;q.replaceRange("",n(w.line,w.ch-1),n(w.line,w.ch+1))}}function b(q){var s=m(q);var u=s&&a(s,"explode");if(!u||q.getOption("disableInput")){return f.Pass}var r=q.listSelections();for(var t=0;t<r.length;t++){if(!r[t].empty()){return f.Pass}var v=g(q,r[t].head);if(!v||u.indexOf(v)%2!=0){return f.Pass}}q.operation(function(){q.replaceSelection("\n\n",null);q.execCommand("goCharLeft");r=q.listSelections();for(var x=0;x<r.length;x++){var w=r[x].head.line;q.indentLine(w,null,true);q.indentLine(w+1,null,true)}})}function o(D,q){var y=m(D);if(!y||D.getOption("disableInput")){return f.Pass}var s=a(y,"pairs");var B=s.indexOf(q);if(B==-1){return f.Pass}var G=a(y,"triples");var C=s.charAt(B+1)==q;var r=D.listSelections();var t=B%2==0;var z,x;for(var v=0;v<r.length;v++){var w=r[v],F=w.head,A;var x=D.getRange(F,n(F.line,F.ch+1));if(t&&!w.empty()){A="surround"}else{if((C||!t)&&x==q){if(G.indexOf(q)>=0&&D.getRange(F,n(F.line,F.ch+3))==q+q+q){A="skipThree"}else{A="skip"}}else{if(C&&F.ch>1&&G.indexOf(q)>=0&&D.getRange(n(F.line,F.ch-2),F)==q+q&&(F.ch<=2||D.getRange(n(F.line,F.ch-3),n(F.line,F.ch-2))!=q)){A="addFour"}else{if(C){if(!f.isWordChar(x)&&l(D,F,q)){A="both"}else{return f.Pass}}else{if(t&&(D.getLine(F.line).length==F.ch||c(x,s)||/\s/.test(x))){A="both"}else{return f.Pass}}}}}if(!z){z=A}else{if(z!=A){return f.Pass}}}var u=B%2?s.charAt(B-1):q;var E=B%2?q:s.charAt(B+1);D.operation(function(){if(z=="skip"){D.execCommand("goCharRight")}else{if(z=="skipThree"){for(var I=0;I<3;I++){D.execCommand("goCharRight")}}else{if(z=="surround"){var H=D.getSelections();for(var I=0;I<H.length;I++){H[I]=u+H[I]+E}D.replaceSelections(H,"around")}else{if(z=="both"){D.replaceSelection(u+E,null);D.execCommand("goCharLeft")}else{if(z=="addFour"){D.replaceSelection(u+u+u+u,"before");D.execCommand("goCharRight")}}}}}})}function c(i,q){var r=q.lastIndexOf(i);return r>-1&&r%2==1}function g(i,r){var q=i.getRange(n(r.line,r.ch-1),n(r.line,r.ch+1));return q.length==2?q:null}function l(i,v,t){var q=i.getLine(v.line);var s=i.getTokenAt(v);if(/\bstring2?\b/.test(s.type)){return false}var u=new f.StringStream(q.slice(0,v.ch)+t+q.slice(v.ch),4);u.pos=u.start=s.start;for(;;){var r=i.getMode().token(u,s.state);if(u.pos>=v.ch+1){return/\bstring2?\b/.test(r)}u.start=u.pos}}});